#!/usr/bin/env ruby

# We cannot use anything like at, since the log file can be edited manually.

require 'internet-usage-limiter'

loop do
  log = InternetUsageLimiter::LogReader.new
  entry = log.entries.last

  t = Time.now
  if entry && entry.active? && ((t - 1)..(t + 1)).include?(entry.finishes_at)
    puts "~ Time is up for #{entry.description}"
    system %(osascript -e 'display notification "Time is up!" with title "#{entry.description}" sound name "Glass"')
    sleep 1
  end

  sleep 1
end
